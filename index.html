<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Postes Hardt 2026</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; margin: 0; }
        body.login-mode { display: flex; align-items: center; justify-content: center; padding: 20px; }
        body.app-mode { display: block; padding: 20px; }
        #loginPage { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); width: 100%; max-width: 400px; text-align: center; }
        #loginPage h2 { color: #764ba2; margin-bottom: 25px; font-size: 1.5em; }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #eee; border-radius: 8px; font-size: 16px; outline: none; }
        .login-input:focus { border-color: #667eea; }
        .btn-login { width: 100%; background: #667eea; color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.1em; margin-top: 15px; transition: 0.3s; }
        .btn-login:hover { background: #5a6fd6; }
        #mainApp { display: none; max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 20px; text-align: center; position: relative; }
        .header h1 { font-size: 1.5em; }
        .admin-gear { position: absolute; top: 15px; right: 20px; font-size: 1.5em; cursor: pointer; transition: 0.3s; }
        .admin-gear:hover { transform: rotate(90deg); }
        .sync-status { position: absolute; top: 15px; left: 20px; font-size: 0.8em; padding: 5px 10px; border-radius: 20px; background: rgba(255,255,255,0.2); }
        .sync-status.online { background: #28a745; }
        .sync-status.offline { background: #dc3545; }
        .breadcrumb { background: #f8f9fa; padding: 12px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .nav-left { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        .nav-left a { color: #667eea; text-decoration: none; font-weight: bold; cursor: pointer; transition: 0.3s; padding: 8px 12px; border-radius: 5px; }
        .nav-left a:hover { background: #667eea; color: white; }
        .nav-left .btn-infractions { background: #e53e3e; color: white; padding: 8px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; border: none; font-size: 0.9em; transition: 0.3s; }
        .nav-left .btn-infractions:hover { background: #c53030; }
        .nav-left .btn-controleur { background: #3182ce; color: white; padding: 8px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; border: none; font-size: 0.9em; transition: 0.3s; }
        .nav-left .btn-controleur:hover { background: #2c5282; }
        .nav-right a { color: #dc3545; text-decoration: none; font-weight: bold; cursor: pointer; padding: 8px 12px; border-radius: 5px; transition: 0.3s; }
        .nav-right a:hover { background: #dc3545; color: white; }
        .content { padding: 20px; }
        .hidden { display: none !important; }
        .months-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .month-card { background: white; border: 3px solid #e9ecef; border-radius: 10px; padding: 25px 15px; text-align: center; cursor: pointer; transition: 0.3s; }
        .month-card:hover { border-color: #667eea; transform: translateY(-5px); box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        .month-name { font-size: 1.3em; font-weight: bold; color: #667eea; }
        .days-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
        .day-card { background: white; border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; text-align: center; cursor: pointer; transition: 0.3s; min-height: 90px; display: flex; flex-direction: column; justify-content: center; }
        .day-card:hover { border-color: #667eea; transform: translateY(-3px); }
        .day-number { font-size: 1em; font-weight: bold; color: #667eea; text-transform: capitalize; }
        .closed-morning { color: #dc3545; font-size: 0.8em; margin-top: 8px; font-weight: bold; }
        .postes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .poste-box { background: #f8f9fa; border: 3px solid #dee2e6; border-radius: 12px; padding: 15px; text-align: center; cursor: pointer; position: relative; transition: 0.3s; min-height: 180px; display: flex; flex-direction: column; justify-content: space-between; align-items: center; }
        .poste-box:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .poste-box.libre { border-color: #28a745; background: #e8f5e9; }
        .poste-box.reserve { border-color: #ffc107; background: #fff9e6; }
        .poste-box.controle { border-color: #17a2b8; background: #e7f6f8; }
        .poste-box.controleur { border-color: #ffd700; border-width: 4px; background: #fffbf0; }
        .poste-content { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; }
        .poste-title { font-weight: bold; font-size: 1.1em; margin-bottom: 5px; }
        .poste-heure { color: #17a2b8; font-size: 0.85em; font-weight: bold; }
        .poste-nom { font-weight: bold; margin-top: 8px; }
        .badge-peche { color: #28a745; font-size: 0.75em; font-weight: bold; margin-top: 5px; border: 1.5px solid #28a745; padding: 3px 6px; border-radius: 5px; background: white; }
        .btn-info { background: #17a2b8; color: white; padding: 5px 10px; font-size: 0.8em; margin-top: 8px; border-radius: 4px; border: none; cursor: pointer; transition: 0.3s; }
        .btn-info:hover { background: #138496; }
        .control-zone { width: 100%; border-top: 1px solid #ddd; padding-top: 10px; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .control-zone input[type="checkbox"] { width: 22px; height: 22px; cursor: pointer; }
        .control-zone .control-label { font-size: 0.85em; color: #666; cursor: pointer; }
        .control-zone .control-label.checked { color: #17a2b8; font-weight: bold; }
        .stats-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 10px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 2em; font-weight: bold; }
        .stat-label { font-size: 0.9em; }
        .modal, .alert-modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); overflow-y: auto; padding: 20px; }
        .modal-content, .alert-content { background: white; margin: 20px auto; border-radius: 15px; width: 100%; max-width: 500px; overflow: hidden; animation: slideDown 0.3s; }
        .modal-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; }
        .modal-body { padding: 20px; }
        .modal-body label { font-weight: bold; color: #333; display: block; margin-top: 12px; margin-bottom: 5px; }
        input[type="text"], input[type="password"] { width: 100%; padding: 12px; margin: 5px 0 10px 0; border: 2px solid #dee2e6; border-radius: 8px; font-size: 16px; outline: none; transition: 0.3s; }
        input[type="text"]:focus, input[type="password"]:focus { border-color: #667eea; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; flex: 1; font-size: 1em; }
        .btn:hover { opacity: 0.9; }
        .btn-save { background: #28a745; color: white; }
        .btn-delete { background: #dc3545; color: white; }
        .btn-unban { background: #17a2b8; color: white; }
        .btn-back { background: #6c757d; color: white; margin-bottom: 15px; display: inline-block; padding: 10px 20px; text-decoration: none; border-radius: 8px; cursor: pointer; border: none; font-weight: bold; font-size: 0.95em; }
        .infraction-item { padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid; }
        .infraction-item.avertissement { border-left-color: #ffc107; }
        .infraction-item.banni { border-left-color: #dc3545; }
        .infraction-item.archive { border-left-color: #6c757d; background: #e9ecef; }
        .infraction-header { display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 10px; }
        .infraction-info { flex: 1; }
        .infraction-actions { display: flex; gap: 5px; flex-wrap: wrap; }
        .infraction-actions .btn { padding: 8px 12px; font-size: 0.85em; flex: 0; }
        .archive-badge { background: #6c757d; color: white; font-size: 0.75em; padding: 3px 8px; border-radius: 4px; display: inline-block; margin-top: 5px; }
        .controleur-badge { background: #3182ce; color: white; font-size: 0.75em; padding: 3px 8px; border-radius: 4px; display: inline-block; margin-top: 5px; }
        .motifs-list { background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 10px; margin-top: 10px; }
        .motifs-list h4 { margin-bottom: 8px; color: #856404; font-size: 0.9em; }
        .motif-item { padding: 5px 0; border-bottom: 1px solid #ffeeba; font-size: 0.85em; }
        .motif-item:last-child { border-bottom: none; }
        .info-motifs { background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 10px; margin-top: 10px; text-align: left; }
        .info-motifs h4 { margin-bottom: 8px; color: #856404; }
        .info-motif-item { padding: 5px 0; border-bottom: 1px solid #ffeeba; font-size: 0.9em; }
        .info-motif-item:last-child { border-bottom: none; }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @media (max-width: 768px) { body.app-mode { padding: 10px; } .header { padding: 20px 15px; } .header h1 { font-size: 1.2em; } .content { padding: 15px; } .months-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; } .postes-grid { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; } }
        @media (max-width: 480px) { body.app-mode { padding: 5px; } #loginPage { padding: 25px 20px; margin: 10px; } .header { padding: 15px 10px; } .header h1 { font-size: 1em; padding: 0 30px; } .breadcrumb { padding: 8px 10px; flex-direction: column; } .months-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; } .postes-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; } .modal-content { margin: 5px; } }
    </style>
</head>
<body class="login-mode">
    <div id="loginPage">
        <h2>üëÆ Connexion<br>R√©servations / Contr√¥les Hardt</h2>
        <input type="text" id="loginID" class="login-input" value="HARDT" readonly tabindex="-1">
        <input type="password" id="loginPass" class="login-input" placeholder="Mot de passe" autofocus>
        <button class="btn-login" onclick="checkLogin()">Se connecter</button>
        <p id="errorLogin" style="color:red; margin-top:15px; font-weight:bold; display:none;">Mot de passe incorrect !</p>
        <p id="firebaseStatus" style="margin-top:15px; font-size:0.85em; color:#666;"></p>
    </div>
    <div id="mainApp">
        <div class="header">
            <span class="sync-status" id="syncStatus">üîÑ Connexion...</span>
            <span class="admin-gear" onclick="openAdmin()">‚öôÔ∏è</span>
            <h1>üìã R√©servation Postes Hardt 2026</h1>
        </div>
        <div class="breadcrumb">
            <div class="nav-left">
                <a onclick="showMonths()">üè† Accueil</a>
                <button class="btn-infractions" onclick="showInfractionsMenu()">‚ö†Ô∏è Infractions</button>
                <button class="btn-controleur" onclick="accesControleur()">üëÆ Contr√¥leur</button>
            </div>
            <div class="nav-right"><a onclick="logout()">D√©connexion üîí</a></div>
        </div>
        <div id="monthsPage" class="content"><div class="months-grid" id="monthsGrid"></div></div>
        <div id="infractionsMenuPage" class="content hidden">
            <button class="btn-back" onclick="showMonths()">‚Üê Retour Accueil</button>
            <div class="months-grid">
                <div class="month-card" onclick="showInfractionList('avertissements')" style="border-color: #ffc107;"><div style="font-size: 2.5em;">‚ö†Ô∏è</div><div class="month-name">AVERTISSEMENTS</div><p id="countAvertissement" style="font-weight: bold; margin-top:10px;">0 dossier(s)</p></div>
                <div class="month-card" onclick="showInfractionList('bannis')" style="border-color: #dc3545;"><div style="font-size: 2.5em;">üö´</div><div class="month-name">BANNISSEMENTS</div><p id="countBanni" style="font-weight: bold; margin-top:10px;">0 dossier(s)</p></div>
            </div>
        </div>
        <div id="infractionsDetailPage" class="content hidden">
            <button class="btn-back" onclick="showInfractionsMenu()">‚Üê Retour</button>
            <h2 id="detailTitle" style="text-align: center; margin-bottom: 20px; color: #667eea;"></h2>
            <div id="detailList"></div>
        </div>
        <div id="daysPage" class="content hidden">
            <button class="btn-back" onclick="showMonths()">‚Üê Retour</button>
            <h2 id="monthTitle" style="text-align: center; margin-bottom: 20px; color: #667eea;"></h2>
            <div class="days-grid" id="daysGrid"></div>
        </div>
        <div id="postesPage" class="content hidden">
            <button class="btn-back" onclick="backToDays()">‚Üê Retour</button>
            <h2 id="postePageTitle" style="text-align: center; color: #667eea; margin-bottom: 15px; text-transform: capitalize; font-size: 1.4em;"></h2>
            <div class="stats-bar">
                <div class="stat-box"><div class="stat-number" id="statLibre">11</div><div class="stat-label">Libres</div></div>
                <div class="stat-box"><div class="stat-number" id="statReserve">0</div><div class="stat-label">R√©serv√©s</div></div>
                <div class="stat-box"><div class="stat-number" id="statControle">0</div><div class="stat-label">Contr√¥l√©s</div></div>
            </div>
            <div id="postesGrid" class="postes-grid"></div>
        </div>
    </div>
    <div id="posteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 id="modalTitle">Poste</h2><p id="modalDate"></p></div>
            <div class="modal-body">
                <label>Nom</label><input type="text" id="modalNom" oninput="checkCardBadge()" placeholder="Entrez le nom">
                <label>Pr√©nom</label><input type="text" id="modalPrenom" oninput="checkCardBadge()" placeholder="Entrez le pr√©nom">
                <div id="modalBadgeZone" style="display:none; margin: 10px 0;"><span class="badge-peche">ü™™ Carte de p√™che valide</span></div>
                <div id="checkZone" style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="modalControle" onchange="updateControlText()" style="width:22px; height:22px; cursor: pointer;">
                        <span id="controlStatusText" style="font-weight: bold;">Cliquer pour valider le contr√¥le</span>
                    </div>
                    <input type="hidden" id="modalHeure">
                </div>
                <div id="infractionsButtons" style="display:none; border-top: 1px solid #ddd; padding-top: 15px; margin-top: 15px;">
                    <p style="font-weight:bold; margin-bottom:10px;">‚ö†Ô∏è Actions Sanctions :</p>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="askMotif('avertissements')" style="background: #ffc107; color: #333;">‚ö†Ô∏è Avertir</button>
                        <button class="btn" onclick="askMotif('bannis')" style="background: #dc3545; color: white;">üö´ Bannir</button>
                    </div>
                </div>
                <div style="display:flex; gap:10px; margin-top:20px; flex-wrap: wrap;">
                    <button class="btn btn-save" onclick="saveModal()">üíæ Sauvegarder</button>
                    <button class="btn btn-delete" onclick="deleteModal()">üóëÔ∏è Effacer</button>
                    <button class="btn" onclick="closeModal()" style="background:#eee; color:#333;">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2>‚öôÔ∏è Administration</h2></div>
            <div class="modal-body">
                <div style="background: #e7f3ff; border: 2px solid #3182ce; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <h3 style="color: #3182ce; margin-bottom: 10px;">üîÑ Synchronisation Google Sheet</h3>
                    <button class="btn" onclick="syncFromGoogleSheets()" style="width:100%; background: #3182ce; color: white; margin-bottom: 10px;">üîÑ Synchroniser depuis Google Sheet</button>
                    <button class="btn" onclick="exportToGoogleSheets()" style="width:100%; background: #28a745; color: white;">üì§ Exporter vers Google Sheet</button>
                </div>
                <div style="border-top: 2px solid #eee; padding-top: 15px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">ü™™ Liste P√™cheurs Valides</h3>
                    <label>NOM</label><input type="text" id="adminAddNom" placeholder="NOM">
                    <label>Pr√©nom</label><input type="text" id="adminAddPrenom" placeholder="Pr√©nom">
                    <button class="btn btn-save" style="width:100%; margin: 15px 0;" onclick="addValidUser()">‚ûï Ajouter √† la liste</button>
                    <div id="adminValidList" style="max-height:200px; overflow-y:auto; border-top:1px solid #eee; padding-top:10px;"></div>
                </div>
                <button class="btn" style="width:100%; background:#eee; color:#333; margin-top:15px;" onclick="closeAdmin()">Fermer</button>
            </div>
        </div>
    </div>
    <div id="motifModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="motifHeader"><h2>Motif de la sanction</h2></div>
            <div class="modal-body">
                <label>üëÆ Contr√¥leur ayant constat√© l'infraction :</label>
                <select id="motifControleur" style="width:100%;padding:12px;font-size:16px;border:2px solid #ddd;border-radius:8px;margin-bottom:15px;">
                    <option value="">-- Choisir le contr√¥leur --</option>
                </select>
                <label>Motif de la sanction :</label>
                <input type="text" id="motifInput" placeholder="Ex: Absence de carte de p√™che...">
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button class="btn btn-save" onclick="confirmSanction()">‚úÖ Confirmer</button>
                    <button class="btn" onclick="closeMotif()" style="background:#eee; color:#333;">Annuler</button>
                </div>
            </div>
        </div>
    </div>
    <div id="alertModal" class="alert-modal">
        <div class="alert-content">
            <div id="alertHeader" style="background:#667eea; color:white; padding:15px; text-align:center;"><h3>INFO</h3></div>
            <div id="alertBody" class="alert-body" style="padding:20px;"></div>
            <div style="text-align:center; padding-bottom:20px;"><button class="btn btn-save" onclick="closeAlert()">OK</button></div>
        </div>
    </div>
    <div id="controleurModal" class="modal">
        <div class="modal-content" style="max-width:350px;">
            <div class="modal-header" style="background:#1565c0;"><h2>üëÆ Contr√¥le</h2></div>
            <div class="modal-body">
                <p style="margin-bottom:15px;font-weight:bold;">S√©lectionnez le contr√¥leur :</p>
                <select id="selectControleur" style="width:100%;padding:12px;font-size:16px;border:2px solid #ddd;border-radius:8px;margin-bottom:20px;"><option value="">-- Choisir --</option></select>
                <div style="display:flex;gap:10px;">
                    <button class="btn btn-save" onclick="confirmControleur()">‚úÖ Valider</button>
                    <button class="btn" onclick="closeControleurModal()" style="background:#eee;color:#333;">Annuler</button>
                </div>
                <div style="margin-top:15px;border-top:1px solid #ddd;padding-top:15px;">
                    <button class="btn" onclick="annulerControle()" style="background:#dc3545;color:white;width:100%;">‚ùå Annuler le contr√¥le</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script>
        (function() { const urlParams = new URLSearchParams(window.location.search); const autoconnect = urlParams.get('autoconnect'); const fromControleur = urlParams.get('from') === 'controleur'; if (autoconnect === '911') { document.addEventListener('DOMContentLoaded', function() { document.getElementById('loginPass').value = '911'; setTimeout(function() { checkLogin(); }, 500); if (fromControleur) { const btn = document.createElement('button'); btn.innerHTML = '‚Üê Retour Contr√¥leur'; btn.style.cssText = 'position:fixed;top:15px;left:15px;z-index:9999;background:linear-gradient(135deg,#1a472a,#2d5a3d);color:#fff;border:none;padding:12px 20px;border-radius:25px;font-size:14px;font-weight:600;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,0.3);'; btn.onclick = function() { window.close(); }; document.body.appendChild(btn); } }); } })();
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwDbuJDOKo7XoycUeOF59V9aW3IDztg6Gx-nlrUnmrHpaPOD3v9x9ek481EL6egzuE/exec";
        function sendToGoogleSheets(data) { fetch(GOOGLE_SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) }).then(() => console.log("‚úÖ Envoy√© GSheets")).catch(err => console.error("‚ùå Erreur:", err)); }
        function syncFromGoogleSheets() { if (!checkAdminPassword()) return; showAlert('Synchronisation...'); /* ... */ closeAlert(); }
        function exportToGoogleSheets() { if (!checkAdminPassword()) return; showAlert('Export...'); /* ... */ closeAlert(); }
        const firebaseConfig = { apiKey: "AIzaSyADXcfDOBLHC7pdlGedDW-4wAHKyPHW19I", authDomain: "resahardt.firebaseapp.com", databaseURL: "https://resahardt-default-rtdb.europe-west1.firebasedatabase.app", projectId: "resahardt", storageBucket: "resahardt.firebasestorage.app", messagingSenderId: "159584744908", appId: "1:159584744908:web:1cc909277052b56e945969" };
        let app, database, firebaseReady = false;
        try { app = firebase.initializeApp(firebaseConfig); database = firebase.database(); firebaseReady = true; } catch (error) { console.error("‚ùå Firebase:", error); }
        const JOURS_OUVERTURE = { 1: [28], 2: [6, 7, 13, 14, 20, 21, 22, 27, 28], 3: [3, 4, 5, 10, 11, 17, 18, 24, 25], 4: [5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], 5: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30], 6: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], 7: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], 8: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30], 9: [2, 3, 9, 10, 16, 17, 23, 24, 30, 31], 10: [6, 7, 10, 13, 14, 20, 21, 27, 28], 11: [4, 5, 11, 12, 18, 19, 24, 25, 26] };
        const FERME_MATIN = { 1: [28], 2: [28], 3: [25], 5: [13], 8: [19], 9: [17], 10: [14] };
        const MOIS_NOMS = ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'];
        let reservations = {}, infractions = { avertissements: [], bannis: [] }, validUsers = [], controleurs = [];
        let pendingControlePoste = null, curM, curMName, curDKey, curP, curFullDate, pendingSanctionType;
        
        function setupFirebaseListeners() { 
            if (!firebaseReady) return; 
            const connectedRef = database.ref(".info/connected"); 
            connectedRef.on("value", (snap) => { 
                const statusEl = document.getElementById('syncStatus'); 
                statusEl.textContent = snap.val() ? "üü¢ En ligne" : "üî¥ Hors ligne"; 
                statusEl.className = "sync-status " + (snap.val() ? "online" : "offline"); 
            }); 
            database.ref('reservations').on('value', (snapshot) => { reservations = snapshot.val() || {}; if (!document.getElementById('postesPage').classList.contains('hidden')) renderPostes(); }); 
            database.ref('infractions').on('value', (snapshot) => { infractions = snapshot.val() || { avertissements: [], bannis: [] }; if (!infractions.avertissements) infractions.avertissements = []; if (!infractions.bannis) infractions.bannis = []; updateCounts(); }); 
            database.ref('validUsers').on('value', (snapshot) => { const data = snapshot.val(); validUsers = data ? Object.values(data) : []; if (!document.getElementById('postesPage').classList.contains('hidden')) renderPostes(); }); 
            database.ref('controleurs').on('value', (snapshot) => { const data = snapshot.val(); controleurs = data ? (Array.isArray(data) ? data : Object.values(data)) : []; updateControleurSelect(); updateMotifControleurSelect(); }); 
        }
        function saveReservations() { if (!firebaseReady) return; database.ref('reservations').set(reservations); }
        function saveInfractions() { if (!firebaseReady) return; database.ref('infractions').set(infractions); }
        function saveValidUsers() { if (!firebaseReady) return; const usersObj = {}; validUsers.forEach((u, i) => { usersObj['user_' + i] = u; }); database.ref('validUsers').set(usersObj); }
        function checkLogin() { if (document.getElementById('loginPass').value === "911") { if (!firebaseReady) { showAlert("‚ö†Ô∏è Connexion Firebase..."); return; } document.getElementById('loginPage').style.display = 'none'; document.getElementById('mainApp').style.display = 'block'; document.body.className = 'app-mode'; sessionStorage.setItem('logged', 'true'); setupFirebaseListeners(); renderMonths(); updateCounts(); } else { document.getElementById('errorLogin').style.display = 'block'; setTimeout(() => { document.getElementById('errorLogin').style.display = 'none'; }, 3000); } }
        document.getElementById("loginPass").addEventListener("keyup", function(e) { if (e.key === "Enter") checkLogin(); });
        function logout() { sessionStorage.removeItem('logged'); location.reload(); }
        function accesControleur() { const today = new Date(); const jour = today.getDate(); const mois = today.getMonth(); if (today.getFullYear() !== 2026) { showAlert("üìÖ Application pour 2026"); return; } const joursOuverts = JOURS_OUVERTURE[mois] || []; if (!joursOuverts.includes(jour)) { showAlert("üö´ √âtang ferm√© aujourd'hui"); return; } const key = `2026-${String(mois + 1).padStart(2, '0')}-${String(jour).padStart(2, '0')}`; const dateFull = today.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' }); curM = mois; curMName = MOIS_NOMS[mois]; showPostes(jour, key, dateFull); }
        function checkAdminPassword() { return prompt("üîê Mot de passe admin :") === "admin"; }
        function hideAll() { ['monthsPage', 'daysPage', 'postesPage', 'infractionsMenuPage', 'infractionsDetailPage'].forEach(id => { document.getElementById(id).classList.add('hidden'); }); }
        function renderMonths() { const grid = document.getElementById('monthsGrid'); grid.innerHTML = MOIS_NOMS.map((m, i) => { if (i === 0) return ''; return `<div class="month-card" onclick="showDays(${i}, '${m}')"><div class="month-name">${m}</div></div>`; }).join(''); }
        function showMonths() { hideAll(); document.getElementById('monthsPage').classList.remove('hidden'); }
        function showDays(m, name) { curM = m; curMName = name; hideAll(); document.getElementById('daysPage').classList.remove('hidden'); document.getElementById('monthTitle').textContent = name + ' 2026'; const grid = document.getElementById('daysGrid'); const jours = JOURS_OUVERTURE[m] || []; grid.innerHTML = jours.map(j => { const date = new Date(2026, m, j); const dateFull = date.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' }); const key = `2026-${String(m + 1).padStart(2, '0')}-${String(j).padStart(2, '0')}`; const isFermeMatin = FERME_MATIN[m] && FERME_MATIN[m].includes(j); const dayRes = reservations[key] || {}; let postesRes = 0; for (let i = 1; i <= 12; i++) { if (i !== 4 && dayRes[i] && dayRes[i].nom) postesRes++; } const postesLibres = 11 - postesRes; return `<div class="day-card" onclick="showPostes(${j}, '${key}', '${dateFull}')"><div style="color: ${postesLibres === 0 ? '#dc3545' : '#28a745'}; font-size: 0.85em;">${postesLibres === 0 ? 'COMPLET' : postesLibres + ' libre(s)'}</div><div class="day-number">${dateFull}</div>${isFermeMatin ? '<div class="closed-morning">‚ö†Ô∏è FERM√â LE MATIN</div>' : ''}</div>`; }).join(''); }
        function showPostes(j, key, dateFull) { curDKey = key; curFullDate = dateFull; hideAll(); document.getElementById('postesPage').classList.remove('hidden'); document.getElementById('postePageTitle').textContent = dateFull + " 2026"; renderPostes(); }
        function backToDays() { showDays(curM, curMName); }
        function renderPostes() { const grid = document.getElementById('postesGrid'); grid.innerHTML = ''; if (!reservations[curDKey]) reservations[curDKey] = {}; let libres = 0, reserves = 0, controles = 0; for (let i = 1; i <= 12; i++) { const data = reservations[curDKey][i] || { nom: '', prenom: '', controlled: false }; if (i !== 4) { if (data.nom) { reserves++; if (data.controlled) controles++; } else { libres++; } } grid.appendChild(createBox(i, data)); } document.getElementById('statLibre').textContent = libres; document.getElementById('statReserve').textContent = reserves; document.getElementById('statControle').textContent = controles; }
        function createBox(n, data) { const div = document.createElement('div'); const isControleur = n === 4; const hasName = data.nom && data.nom.trim() !== ''; let className = 'poste-box '; if (isControleur) className += 'controleur'; else if (data.controlled) className += 'controle'; else if (hasName) className += 'reserve'; else className += 'libre'; div.className = className; div.onclick = (e) => { if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'BUTTON') openModal(n, data); }; let html = '<div class="poste-content">'; html += `<div class="poste-title">Poste ${n}</div>`; if (data.controlled && data.heure) html += `<div class="poste-heure">üïí ${data.heure}</div>`; if (hasName) { html += `<div class="poste-nom">${data.nom.toUpperCase()} ${data.prenom}</div>`; if (isUserValid(data.nom, data.prenom)) html += '<div class="badge-peche">ü™™ Carte valide</div>'; html += `<button class="btn-info" onclick="event.stopPropagation(); checkInfo('${escapeHtml(data.nom)}', '${escapeHtml(data.prenom)}')">‚ÑπÔ∏è Info</button>`; } html += '</div>'; if (!isControleur) { if (data.controlled) { html += `<div class="control-zone" onclick="event.stopPropagation(); toggleControle(${n})" style="cursor:pointer;"><span class="control-label checked">‚úÖ Contr√¥l√© par ${data.controleur || 'inconnu'}</span></div>`; } else { html += `<div class="control-zone"><input type="checkbox" id="check_${n}" onclick="event.stopPropagation(); toggleControle(${n})"><label class="control-label">Cliquer pour contr√¥ler</label></div>`; } } div.innerHTML = html; return div; }
        function escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML.replace(/'/g, "\\'"); }
        function toggleControle(n) { if (!reservations[curDKey]) reservations[curDKey] = {}; if (!reservations[curDKey][n]) return; pendingControlePoste = n; document.getElementById('selectControleur').value = reservations[curDKey][n].controleur || ''; document.getElementById('controleurModal').style.display = 'block'; }
        function updateControleurSelect() { const select = document.getElementById('selectControleur'); if (!select) return; select.innerHTML = '<option value="">-- Choisir --</option>' + controleurs.map(c => `<option value="${c}">${c}</option>`).join(''); }
        function updateMotifControleurSelect() { const select = document.getElementById('motifControleur'); if (!select) return; select.innerHTML = '<option value="">-- Choisir le contr√¥leur --</option>' + controleurs.map(c => `<option value="${c}">${c}</option>`).join(''); }
        function closeControleurModal() { document.getElementById('controleurModal').style.display = 'none'; pendingControlePoste = null; renderPostes(); }
        function confirmControleur() { const controleur = document.getElementById('selectControleur').value; if (!controleur) { alert('Choisir un contr√¥leur'); return; } const poste = reservations[curDKey][pendingControlePoste]; if (poste) { poste.controlled = true; poste.controleur = controleur; const now = new Date(); poste.heure = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0'); saveReservations(); } closeControleurModal(); }
        function annulerControle() { const poste = reservations[curDKey][pendingControlePoste]; if (poste) { poste.controlled = false; poste.controleur = ''; poste.heure = ''; saveReservations(); } closeControleurModal(); }
        function openModal(n, data) { curP = n; document.getElementById('modalTitle').textContent = 'Poste ' + n; document.getElementById('modalDate').textContent = curFullDate + " 2026"; document.getElementById('modalNom').value = data.nom || ''; document.getElementById('modalPrenom').value = data.prenom || ''; document.getElementById('modalControle').checked = data.controlled || false; document.getElementById('modalHeure').value = data.heure || ''; updateControlText(); checkCardBadge(); document.getElementById('checkZone').style.display = n === 4 ? 'none' : 'block'; document.getElementById('infractionsButtons').style.display = (data.nom && n !== 4) ? 'block' : 'none'; document.getElementById('posteModal').style.display = 'block'; }
        function closeModal() { document.getElementById('posteModal').style.display = 'none'; }
        function saveModal() { let nom = document.getElementById('modalNom').value.trim().toUpperCase(); let prenom = document.getElementById('modalPrenom').value.trim(); if (!nom || !prenom) { closeModal(); return; } prenom = prenom.charAt(0).toUpperCase() + prenom.slice(1).toLowerCase(); const banni = infractions.bannis ? infractions.bannis.find(b => b.nom && b.nom.toUpperCase() === nom && b.prenom && b.prenom.toLowerCase() === prenom.toLowerCase()) : null; if (banni) { showAlert(`üö´ ${nom} ${prenom} est BANNI !`); return; } if (!reservations[curDKey]) reservations[curDKey] = {}; reservations[curDKey][curP] = { nom: nom, prenom: prenom, controlled: document.getElementById('modalControle').checked, heure: document.getElementById('modalHeure').value }; saveReservations(); renderPostes(); closeModal(); }
        function deleteModal() { if (reservations[curDKey] && reservations[curDKey][curP]) { delete reservations[curDKey][curP]; saveReservations(); renderPostes(); } closeModal(); }
        function updateControlText() { const cb = document.getElementById('modalControle'); if (cb.checked) { if (!document.getElementById('modalHeure').value) { const now = new Date(); document.getElementById('modalHeure').value = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0'); } document.getElementById('controlStatusText').textContent = "‚úÖ Contr√¥l√© √† " + document.getElementById('modalHeure').value; document.getElementById('controlStatusText').style.color = "#17a2b8"; } else { document.getElementById('controlStatusText').textContent = "Cliquer pour valider le contr√¥le"; document.getElementById('controlStatusText').style.color = "#666"; } }
        function isUserValid(nom, prenom) { return validUsers.some(u => u.nom && u.prenom && u.nom.toLowerCase() === nom.trim().toLowerCase() && u.prenom.toLowerCase() === prenom.trim().toLowerCase()); }
        function checkCardBadge() { document.getElementById('modalBadgeZone').style.display = isUserValid(document.getElementById('modalNom').value, document.getElementById('modalPrenom').value) ? 'block' : 'none'; }
        function showInfractionsMenu() { hideAll(); document.getElementById('infractionsMenuPage').classList.remove('hidden'); updateCounts(); }
        function updateCounts() { document.getElementById('countAvertissement').textContent = (infractions.avertissements ? infractions.avertissements.length : 0) + ' dossier(s)'; document.getElementById('countBanni').textContent = (infractions.bannis ? infractions.bannis.length : 0) + ' dossier(s)'; }
        function showInfractionList(type) { hideAll(); document.getElementById('infractionsDetailPage').classList.remove('hidden'); document.getElementById('detailTitle').textContent = type === 'avertissements' ? '‚ö†Ô∏è AVERTISSEMENTS' : 'üö´ BANNISSEMENTS'; const list = infractions[type] || []; const container = document.getElementById('detailList'); if (list.length === 0) { container.innerHTML = '<p style="text-align:center; color:#666;">Aucun dossier</p>'; return; } if (type === 'avertissements') { container.innerHTML = list.map((item, index) => `<div class="infraction-item ${item.archived ? 'archive' : 'avertissement'}"><div class="infraction-header"><div class="infraction-info"><strong>${(item.nom || 'N/A').toUpperCase()} ${item.prenom || ''}</strong>${item.archived ? '<span class="archive-badge">üìÅ Archiv√©</span>' : ''}${item.controleurSanction ? '<span class="controleur-badge">üëÆ ' + item.controleurSanction + '</span>' : ''}<br><small>üìÖ ${item.date || ''}</small><br><small>üìù ${item.motif || ''}</small></div><div class="infraction-actions"><button class="btn btn-delete" onclick="removeAvertissement(${index})">üóëÔ∏è</button></div></div></div>`).join(''); } else { container.innerHTML = list.map((item, index) => { let motifsHtml = ''; if (item.motifs && item.motifs.length > 0) { motifsHtml = `<div class="motifs-list"><h4>üìã Motifs :</h4>${item.motifs.map((m, i) => `<div class="motif-item"><strong>#${i+1}</strong> - ${m.date || ''}: ${m.motif || ''}${m.controleurSanction ? ' <em>(üëÆ ' + m.controleurSanction + ')</em>' : ''}</div>`).join('')}</div>`; } else if (item.motif) { motifsHtml = `<div class="motifs-list"><h4>üìã Motif :</h4><div class="motif-item">${item.motif}</div></div>`; } return `<div class="infraction-item banni"><div class="infraction-header"><div class="infraction-info"><strong>${(item.nom || 'N/A').toUpperCase()} ${item.prenom || ''}</strong>${item.controleurSanction ? '<span class="controleur-badge">üëÆ ' + item.controleurSanction + '</span>' : ''}<br><small>üìÖ Banni le : ${item.date || ''}</small>${motifsHtml}</div><div class="infraction-actions"><button class="btn btn-unban" onclick="debannir(${index})">üîì D√©bannir</button><button class="btn btn-delete" onclick="removeBanni(${index})">üóëÔ∏è</button></div></div></div>`; }).join(''); } }
        function removeAvertissement(index) { if (!checkAdminPassword()) return; infractions.avertissements.splice(index, 1); saveInfractions(); showInfractionList('avertissements'); showAlert("‚úÖ Avertissement supprim√©."); }
        function removeBanni(index) { if (!checkAdminPassword()) return; if (!confirm('Supprimer ce bannissement ?')) return; infractions.bannis.splice(index, 1); saveInfractions(); showInfractionList('bannis'); showAlert("‚úÖ Bannissement supprim√©."); }
        function debannir(index) { if (!checkAdminPassword()) return; const banni = infractions.bannis[index]; if (banni.motifs && banni.motifs.length > 0) { banni.motifs.forEach(m => { infractions.avertissements.push({ id: Date.now().toString() + Math.random(), nom: banni.nom, prenom: banni.prenom, motif: m.motif, date: m.date, controleurSanction: m.controleurSanction, archived: true }); }); } infractions.bannis.splice(index, 1); saveInfractions(); showInfractionList('bannis'); showAlert(`‚úÖ ${banni.nom} ${banni.prenom} d√©banni.`); }
        function askMotif(type) { pendingSanctionType = type; document.getElementById('motifHeader').style.background = type === 'bannis' ? '#dc3545' : '#ffc107'; document.getElementById('motifInput').value = ''; document.getElementById('motifControleur').value = ''; updateMotifControleurSelect(); document.getElementById('motifModal').style.display = 'block'; }
        function closeMotif() { document.getElementById('motifModal').style.display = 'none'; }
        function confirmSanction() { 
            const nom = document.getElementById('modalNom').value.trim().toUpperCase(); 
            const prenom = document.getElementById('modalPrenom').value.trim(); 
            const prenomF = prenom.charAt(0).toUpperCase() + prenom.slice(1).toLowerCase(); 
            const motif = document.getElementById('motifInput').value || "Non sp√©cifi√©"; 
            const controleurSanction = document.getElementById('motifControleur').value || "Non sp√©cifi√©";
            const dateNow = new Date().toLocaleString('fr-FR'); 
            if (!infractions.avertissements) infractions.avertissements = []; 
            if (!infractions.bannis) infractions.bannis = []; 
            if (pendingSanctionType === 'avertissements') { 
                infractions.avertissements.push({ id: Date.now().toString(), nom: nom, prenom: prenomF, motif: motif, controleurSanction: controleurSanction, date: dateNow }); 
                const fullName = (nom + ' ' + prenomF).toLowerCase(); 
                const userAvert = infractions.avertissements.filter(a => (a.nom + ' ' + a.prenom).toLowerCase() === fullName && !a.archived); 
                if (userAvert.length >= 3) { 
                    const motifs = userAvert.map(a => ({ motif: a.motif, date: a.date, controleurSanction: a.controleurSanction })); 
                    infractions.bannis.push({ id: Date.now().toString(), nom: nom, prenom: prenomF, motifs: motifs, controleurSanction: controleurSanction, date: dateNow }); 
                    infractions.avertissements = infractions.avertissements.filter(a => (a.nom + ' ' + a.prenom).toLowerCase() !== fullName || a.archived); 
                    saveInfractions(); 
                    closeMotif(); 
                    closeModal(); 
                    showAlert(`üö´ ${nom} ${prenomF} BANNI (3 avertissements)`); 
                    return; 
                } 
                saveInfractions(); 
                closeMotif(); 
                closeModal(); 
                showAlert(`‚úÖ Avertissement pour ${nom} ${prenomF} (${userAvert.length}/3)<br>üëÆ Par: ${controleurSanction}`); 
            } else { 
                infractions.bannis.push({ id: Date.now().toString(), nom: nom, prenom: prenomF, motif: motif, controleurSanction: controleurSanction, date: dateNow }); 
                saveInfractions(); 
                closeMotif(); 
                closeModal(); 
                showAlert(`üö´ ${nom} ${prenomF} BANNI<br>üëÆ Par: ${controleurSanction}`); 
            } 
        }
        function checkInfo(nom, prenom) { 
            const fullName = (nom + ' ' + prenom).toLowerCase(); 
            const avertissements = infractions.avertissements ? infractions.avertissements.filter(a => (a.nom + ' ' + a.prenom).toLowerCase() === fullName && !a.archived) : []; 
            const bannissement = infractions.bannis ? infractions.bannis.find(b => (b.nom + ' ' + b.prenom).toLowerCase() === fullName) : null; 
            const isValid = isUserValid(nom, prenom); 
            let html = `<div style="text-align: left;"><h3 style="text-align: center;">${nom.toUpperCase()} ${prenom}</h3>`; 
            html += `<p>${isValid ? 'ü™™ Carte valide' : '‚ùå Pas de carte'}</p>`; 
            if (bannissement) { 
                html += '<p style="color: #dc3545; font-weight: bold;">üö´ BANNI</p>'; 
                if (bannissement.controleurSanction) html += `<p>üëÆ Sanctionn√© par: <strong>${bannissement.controleurSanction}</strong></p>`;
                if (bannissement.motifs && bannissement.motifs.length > 0) { 
                    html += '<div class="info-motifs" style="background: #f8d7da;"><h4 style="color: #721c24;">Motifs :</h4>'; 
                    bannissement.motifs.forEach((m, i) => { html += `<div class="info-motif-item"><strong>#${i+1}</strong> - ${m.date || ''}: ${m.motif || ''}${m.controleurSanction ? '<br>üëÆ ' + m.controleurSanction : ''}</div>`; }); 
                    html += '</div>'; 
                } 
            } else { 
                html += '<p style="color: #28a745;">‚úÖ Non banni</p>'; 
            } 
            html += `<p style="font-weight: bold;">‚ö†Ô∏è Avertissements actifs : ${avertissements.length}/3</p>`; 
            if (avertissements.length > 0) { 
                html += '<div class="info-motifs"><h4>D√©tails :</h4>'; 
                avertissements.forEach((a, i) => { html += `<div class="info-motif-item"><strong>#${i + 1}</strong> - ${a.date || ''}: ${a.motif || ''}${a.controleurSanction ? '<br>üëÆ ' + a.controleurSanction : ''}</div>`; }); 
                html += '</div>'; 
            } 
            html += '</div>'; 
            showAlert(html); 
        }
        function openAdmin() { if (prompt("Code Admin :") === "admin") { renderAdminList(); document.getElementById('adminModal').style.display = 'block'; } }
        function closeAdmin() { document.getElementById('adminModal').style.display = 'none'; }
        function addValidUser() { let nom = document.getElementById('adminAddNom').value.trim().toUpperCase(); let prenom = document.getElementById('adminAddPrenom').value.trim(); if (nom && prenom) { prenom = prenom.charAt(0).toUpperCase() + prenom.slice(1).toLowerCase(); validUsers.push({ nom: nom, prenom: prenom }); saveValidUsers(); renderAdminList(); document.getElementById('adminAddNom').value = ""; document.getElementById('adminAddPrenom').value = ""; } }
        function renderAdminList() { const container = document.getElementById('adminValidList'); container.innerHTML = validUsers.length === 0 ? '<p style="color:#666; text-align:center;">Aucun p√™cheur</p>' : validUsers.map((u, i) => `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; background:#f8f9fa; padding:8px 12px; border-radius:5px;"><span>${u.nom} ${u.prenom}</span><button onclick="removeValidUser(${i})" style="color:red; border:none; background:none; cursor:pointer;">‚úñ</button></div>`).join(''); }
        function removeValidUser(index) { if (confirm('Supprimer ?')) { validUsers.splice(index, 1); saveValidUsers(); renderAdminList(); } }
        function showAlert(msg) { document.getElementById('alertBody').innerHTML = msg; document.getElementById('alertModal').style.display = 'block'; }
        function closeAlert() { document.getElementById('alertModal').style.display = 'none'; }
        document.addEventListener('DOMContentLoaded', function() { if (firebaseReady) { document.getElementById('firebaseStatus').innerHTML = '‚úÖ Firebase connect√©'; document.getElementById('firebaseStatus').style.color = 'green'; } if (sessionStorage.getItem('logged') === 'true') { const checkFb = setInterval(() => { if (firebaseReady) { clearInterval(checkFb); document.getElementById('loginPage').style.display = 'none'; document.getElementById('mainApp').style.display = 'block'; document.body.className = 'app-mode'; setupFirebaseListeners(); renderMonths(); updateCounts(); } }, 100); } });
    </script>
</body>
</html>
