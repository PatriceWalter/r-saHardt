<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©servation Postes Hardt 2026</title>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

      const firebaseConfig = {
        apiKey: "AIzaSyADXcfDOBLHC7pdlGedDW-4wAHKyPHW19I",
        authDomain: "resahardt.firebaseapp.com",
        projectId: "resahardt",
        storageBucket: "resahardt.firebasestorage.app",
        messagingSenderId: "159584744908",
        appId: "1:159584744908:web:1cc909277052b56e945969",
        measurementId: "G-ZCGBGZK2P9"
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .breadcrumb {
            background: #f8f9fa;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95em;
            color: #6c757d;
            border-bottom: 1px solid #eee;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content {
            padding: 30px;
        }

        /* Page Mois */
        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .month-card {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .month-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .month-card .month-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .month-card .month-info {
            color: #6c757d;
        }

        /* Page Jours */
        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .day-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .day-card:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .day-stats {
            font-size: 0.85em;
            color: #28a745;
            margin-top: 10px;
        }

        /* Page Postes */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .postes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .poste-box {
            background: #f8f9fa;
            border: 3px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .poste-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .poste-box.libre { border-color: #28a745; background: #e8f5e9; }
        .poste-box.reserve { border-color: #ffc107; background: #fff9e6; }
        .poste-box.controle { border-color: #17a2b8; background: #e7f6f8; }
        .poste-box.controleur { border-color: #ffd700; border-width: 4px; background: #fffbf0; }

        .hidden { display: none; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
        }

        .form-group {
            margin-bottom: 20px;
            padding: 0 30px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            padding: 20px 30px;
            background: #f8f9fa;
            border-radius: 0 0 15px 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            flex: 1;
            transition: opacity 0.2s;
        }

        .btn-save { background: #28a745; color: white; }
        .btn-delete { background: #dc3545; color: white; }
        .btn:hover { opacity: 0.9; }

        /* Listing Infractions Style */
        .infraction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 5px;
        }

        .btn-remove {
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 2px 8px;
            cursor: pointer;
        }

        /* Style pour les alertes */
        .alert-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }

        .alert-content {
            background-color: white;
            margin: 15% auto;
            width: 90%;
            max-width: 400px;
            border-radius: 15px;
            text-align: center;
            overflow: hidden;
        }

        .alert-header {
            padding: 20px;
            color: white;
            font-size: 1.2em;
            font-weight: bold;
        }

        .alert-header.error { background-color: #dc3545; }
        .alert-header.warning { background-color: #ffc107; color: #000; }

        .alert-body {
            padding: 30px;
            font-size: 1.1em;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã R√©servation Postes Hardt 2026</h1>
            <p id="headerSubtitle">S√©lectionnez un mois pour commencer</p>
        </div>

        <div class="breadcrumb" id="breadcrumb">
            <a onclick="showMonths()">Accueil</a>
        </div>

        <div id="monthsPage" class="content">
            <div class="months-grid" id="monthsGrid"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="showInfractions()" style="background: #e53e3e; color: white; max-width: 300px;">
                    ‚ö†Ô∏è Listing Infractions
                </button>
            </div>
        </div>

        <div id="infractionsPage" class="content hidden">
            <button class="btn" onclick="showMonths()" style="background: #6c757d; color: white; margin-bottom: 20px; max-width: 200px;">
                ‚Üê Retour √† l'accueil
            </button>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div style="border: 2px solid #ffc107; padding: 15px; border-radius: 10px;">
                    <h3 style="margin-bottom:15px; color:#856404;">‚ö†Ô∏è Avertissements en cours</h3>
                    <div id="avertissementsList"></div>
                </div>
                <div style="border: 2px solid #dc3545; padding: 15px; border-radius: 10px;">
                    <h3 style="margin-bottom:15px; color:#721c24;">üö´ Personnes bannies</h3>
                    <div id="bannisList"></div>
                </div>
            </div>
        </div>

        <div id="daysPage" class="content hidden">
            <button class="btn" onclick="showMonths()" style="background: #6c757d; color: white; margin-bottom: 20px; max-width: 200px;">
                ‚Üê Retour aux mois
            </button>
            <h2 id="monthTitle" style="text-align: center; margin-bottom: 30px; color: #4a5568;"></h2>
            <div id="daysGrid" class="days-grid"></div>
        </div>

        <div id="postesPage" class="content hidden">
            <button class="btn" onclick="backToDays()" style="background: #6c757d; color: white; margin-bottom: 20px; max-width: 200px;">
                ‚Üê Retour aux jours
            </button>
            
            <div class="stats-bar">
                <div class="stat-box">
                    <div id="statLibre" style="font-size: 2em; font-weight: bold;">0</div>
                    <div>Postes Libres</div>
                </div>
                <div class="stat-box">
                    <div id="statReserve" style="font-size: 2em; font-weight: bold;">0</div>
                    <div>Postes R√©serv√©s</div>
                </div>
                <div class="stat-box">
                    <div id="statControle" style="font-size: 2em; font-weight: bold;">0</div>
                    <div>Postes Contr√¥l√©s</div>
                </div>
            </div>

            <div id="postesGrid" class="postes-grid"></div>
        </div>
    </div>

    <div id="posteModal" class="modal">
        <div class="modal-content">
            <div class="header">
                <h2 id="modalTitle">Poste X</h2>
                <p id="modalDate">Date s√©lectionn√©e</p>
            </div>
            
            <div class="form-group">
                <br>
                <label>Nom de famille</label>
                <input type="text" id="modalNom" placeholder="Ex: MARTIN">
            </div>
            
            <div class="form-group">
                <label>Pr√©nom</label>
                <input type="text" id="modalPrenom" placeholder="Ex: Jean">
            </div>

            <div class="form-group" id="ctrlGroup">
                <div style="display: flex; align-items: center; gap: 10px; background: #e7f6f8; padding: 10px; border-radius: 8px; border: 1px solid #17a2b8;">
                    <input type="checkbox" id="modalControle" style="width: 20px; height: 20px;">
                    <label style="margin-bottom: 0;">Marquer comme contr√¥l√© par le garde</label>
                </div>
            </div>

            <div id="infractionsButtons" style="padding: 10px 30px; display: none; text-align: center; border-top: 1px solid #eee;">
                <p style="margin-bottom: 10px; font-weight: bold; color: #666;">Gestion des infractions</p>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="addAvertissement()" style="background: #ffc107; color: #000;">‚ö†Ô∏è Avertir</button>
                    <button class="btn" onclick="addBanni()" style="background: #dc3545; color: white;">üö´ Bannir</button>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-save" onclick="saveModal()">üíæ Sauvegarder</button>
                <button class="btn btn-delete" onclick="deleteModal()">üóëÔ∏è Effacer</button>
                <button class="btn" onclick="closeModal()" style="background: #6c757d; color: white;">Fermer</button>
            </div>
        </div>
    </div>

    <div id="alertModal" class="alert-modal">
        <div class="alert-content">
            <div id="alertHeader" class="alert-header"></div>
            <div id="alertBody" class="alert-body"></div>
            <div style="padding: 20px; background: #f8f9fa;">
                <button class="btn" onclick="closeAlert()" style="background: #4a5568; color: white; max-width: 100px;">OK</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const NUM_POSTES = 12;
        const MOIS_NOMS = [
            'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
            'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'
        ];

        // Jours d'ouverture autoris√©s par mois (2026)
        const JOURS_OUVERTURE = {
            1: [28], 
            2: [6, 7, 13, 14, 20, 21, 22, 27, 28], 
            3: [3, 4, 5, 10, 11, 17, 18, 24, 25], 
            4: Array.from({length: 27}, (_, i) => i + 5), 
            5: Array.from({length: 30}, (_, i) => i + 1), 
            6: Array.from({length: 31}, (_, i) => i + 1), 
            7: Array.from({length: 31}, (_, i) => i + 1), 
            8: Array.from({length: 30}, (_, i) => i + 1), 
            9: [2, 3, 9, 10, 16, 17, 23, 24, 30, 31], 
            10: [6, 7, 10, 13, 14, 20, 21, 27, 28], 
            11: [4, 5, 11, 12, 18, 19, 24, 25, 26] 
        };

        let reservations = JSON.parse(localStorage.getItem('reservations_2026')) || {};
        let infractions = JSON.parse(localStorage.getItem('infractions_hardt')) || { avertissements: [], bannis: [] };
        let currentMonth = 0;
        let currentDay = 0;
        let currentDateKey = '';
        let currentPosteNum = 0;

        function showMonths() {
            const grid = document.getElementById('monthsGrid');
            grid.innerHTML = '';
            MOIS_NOMS.forEach((nom, index) => {
                if (index === 0) return;
                const card = document.createElement('div');
                card.className = 'month-card';
                card.innerHTML = `<div class="month-name">${nom}</div><div class="month-info">Saison 2026</div>`;
                card.onclick = () => showDays(index, nom);
                grid.appendChild(card);
            });
            document.getElementById('monthsPage').classList.remove('hidden');
            document.getElementById('daysPage').classList.add('hidden');
            document.getElementById('postesPage').classList.add('hidden');
            document.getElementById('infractionsPage').classList.add('hidden');
        }

        function showDays(monthIndex, monthName) {
            currentMonth = monthIndex;
            const grid = document.getElementById('daysGrid');
            grid.innerHTML = '';
            document.getElementById('monthTitle').textContent = monthName + " 2026";
            
            const jours = JOURS_OUVERTURE[monthIndex] || [];
            
            jours.forEach(jour => {
                const dateKey = `2026-${String(monthIndex + 1).padStart(2, '0')}-${String(jour).padStart(2, '0')}`;
                const resCount = Object.keys(reservations[dateKey] || {}).length;
                
                // --- MODIFICATION ICI POUR DATE COMPLETE ---
                const dateObj = new Date(2026, monthIndex, jour);
                const options = { weekday: 'long', day: 'numeric', month: 'long' };
                const dateComplete = dateObj.toLocaleDateString('fr-FR', options);
                const capitalDate = dateComplete.charAt(0).toUpperCase() + dateComplete.slice(1);

                const card = document.createElement('div');
                card.className = 'day-card';
                card.innerHTML = `
                    <div style="font-size: 1em; font-weight: bold; color: #4a5568;">${capitalDate}</div>
                    <div class="day-stats">${11 - resCount} postes libres</div>
                `;
                card.onclick = () => showPostes(monthIndex, jour, dateKey);
                grid.appendChild(card);
            });

            document.getElementById('monthsPage').classList.add('hidden');
            document.getElementById('daysPage').classList.remove('hidden');
        }

        function showPostes(month, day, dateKey) {
            currentDateKey = dateKey;
            currentDay = day;
            document.getElementById('daysPage').classList.add('hidden');
            document.getElementById('postesPage').classList.remove('hidden');
            renderPostes();
        }

        function backToDays() {
            showDays(currentMonth, MOIS_NOMS[currentMonth]);
        }

        function renderPostes() {
            const grid = document.getElementById('postesGrid');
            grid.innerHTML = '';
            const dayData = reservations[currentDateKey] || {};
            let countLibre = 0, countReserve = 0, countControle = 0;

            for (let i = 1; i <= NUM_POSTES; i++) {
                const data = dayData[i] || { nom: '', prenom: '', controlled: false };
                if (i === 4 && !data.nom) data.nom = "CONTR√îLEUR";

                let statusClass = 'libre';
                if (i === 4) statusClass = 'controleur';
                else if (data.controlled) { statusClass = 'controle'; countControle++; }
                else if (data.nom) { statusClass = 'reserve'; countReserve++; }
                else { countLibre++; }

                const box = document.createElement('div');
                box.className = `poste-box ${statusClass}`;
                const isChecked = data.controlled ? 'checked' : '';
                const checkboxHtml = (i !== 4) ? `<input type="checkbox" class="poste-checkbox" ${isChecked} onclick="event.stopPropagation(); toggleQuickControle(${i})">` : '';

                box.innerHTML = `
                    ${checkboxHtml}
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Poste</div>
                    <div style="font-size: 1.8em; font-weight: bold; margin-bottom: 10px;">${i}</div>
                    <div style="font-weight: 600; min-height: 20px;">${data.nom}</div>
                    <div style="font-size: 0.9em;">${data.prenom || ''}</div>
                `;
                box.onclick = () => openModal(i, data);
                grid.appendChild(box);
            }
            document.getElementById('statLibre').textContent = countLibre;
            document.getElementById('statReserve').textContent = countReserve;
            document.getElementById('statControle').textContent = countControle;
        }

        function openModal(num, data) {
            currentPosteNum = num;
            document.getElementById('modalTitle').textContent = "Poste n¬∞" + num;
            document.getElementById('modalDate').textContent = `Le ${currentDay} ${MOIS_NOMS[currentMonth]} 2026`;
            document.getElementById('modalNom').value = (num === 4 && data.nom === "CONTR√îLEUR") ? "" : (data.nom || "");
            document.getElementById('modalPrenom').value = data.prenom || "";
            document.getElementById('modalControle').checked = data.controlled || false;
            document.getElementById('ctrlGroup').style.display = (num === 4) ? 'none' : 'block';
            document.getElementById('infractionsButtons').style.display = (data.nom && data.nom !== "CONTR√îLEUR") ? 'block' : 'none';
            document.getElementById('posteModal').style.display = 'block';
        }

        function closeModal() { document.getElementById('posteModal').style.display = 'none'; }

        function saveModal() {
            const nom = document.getElementById('modalNom').value.toUpperCase().trim();
            const prenom = document.getElementById('modalPrenom').value.trim();
            const isControlled = document.getElementById('modalControle').checked;
            if (currentPosteNum !== 4 && (!nom || !prenom)) { showAlert('Veuillez saisir un nom et un pr√©nom', 'warning'); return; }
            const fullIdentity = (nom + " " + prenom).toLowerCase();
            if (infractions.bannis.some(b => (b.nom + " " + b.prenom).toLowerCase() === fullIdentity)) { showAlert(`üö´ ACC√àS REFUS√â`, 'error'); return; }
            if (!reservations[currentDateKey]) reservations[currentDateKey] = {};
            reservations[currentDateKey][currentPosteNum] = { nom: nom || (currentPosteNum === 4 ? "CONTR√îLEUR" : ""), prenom: prenom, controlled: isControlled };
            saveData(); renderPostes(); closeModal();
        }

        function deleteModal() { if (reservations[currentDateKey]) delete reservations[currentDateKey][currentPosteNum]; saveData(); renderPostes(); closeModal(); }

        function toggleQuickControle(num) { if (reservations[currentDateKey] && reservations[currentDateKey][num]) { reservations[currentDateKey][num].controlled = !reservations[currentDateKey][num].controlled; saveData(); renderPostes(); } }

        function showAlert(message, type) {
            const modal = document.getElementById('alertModal');
            const header = document.getElementById('alertHeader');
            const body = document.getElementById('alertBody');
            header.className = 'alert-header ' + type;
            header.textContent = type === 'error' ? 'üö´ ACTION BLOQU√âE' : '‚ö†Ô∏è INFORMATION';
            body.innerHTML = message;
            modal.style.display = 'block';
        }

        function closeAlert() { document.getElementById('alertModal').style.display = 'none'; }

        function showInfractions() {
            document.getElementById('monthsPage').classList.add('hidden');
            document.getElementById('infractionsPage').classList.remove('hidden');
            renderInfractionsList();
        }

        function renderInfractionsList() {
            const listA = document.getElementById('avertissementsList');
            const listB = document.getElementById('bannisList');
            listA.innerHTML = infractions.avertissements.map(a => `<div class="infraction-item"><span><strong>${a.nom}</strong> ${a.prenom}</span><button class="btn-remove" onclick="removeAvertissement('${a.id}')">Supprimer</button></div>`).join('') || '<p style="color:gray">Aucun</p>';
            listB.innerHTML = infractions.bannis.map(b => `<div class="infraction-item"><span><strong>${b.nom}</strong> ${b.prenom}</span><button class="btn-remove" onclick="removeBanni('${b.id}')">R√©habiliter</button></div>`).join('') || '<p style="color:gray">Aucun</p>';
        }

        function addAvertissement() {
            const nom = document.getElementById('modalNom').value.trim(), prenom = document.getElementById('modalPrenom').value.trim();
            if (!nom) return;
            infractions.avertissements.push({ id: Date.now().toString(), nom, prenom, date: new Date().toLocaleDateString() });
            saveData(); closeModal(); showAlert("Avertissement ajout√©", "warning");
        }
        
        function addBanni() {
            const nom = document.getElementById('modalNom').value.trim(), prenom = document.getElementById('modalPrenom').value.trim();
            if (!nom) return;
            infractions.bannis.push({ id: Date.now().toString(), nom, prenom, date: new Date().toLocaleDateString() });
            saveData(); closeModal(); showAlert("Banni ajout√©", "error");
        }
        
        function removeAvertissement(id) { infractions.avertissements = infractions.avertissements.filter(a => a.id !== id); saveData(); renderInfractionsList(); }
        function removeBanni(id) { infractions.bannis = infractions.bannis.filter(b => b.id !== id); saveData(); renderInfractionsList(); }

        function saveData() {
            localStorage.setItem('reservations_2026', JSON.stringify(reservations));
            localStorage.setItem('infractions_hardt', JSON.stringify(infractions));
        }

        showMonths();
    </script>
</body>
</html>
