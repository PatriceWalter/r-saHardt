<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion Postes Hardt 2026</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        
        /* LOGIN */
        body.login-mode { display: flex; align-items: center; justify-content: center; padding: 20px; }
        #loginPage { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); width: 100%; max-width: 400px; text-align: center; }
        
        /* APP */
        body.app-mode { display: block; padding: 20px; }
        #mainApp { display: none; max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); overflow: hidden; }
        
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; position: relative; }
        .admin-gear { position: absolute; top: 15px; right: 20px; font-size: 1.5em; cursor: pointer; }
        .breadcrumb { background: #f8f9fa; padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        .content { padding: 20px; }
        
        .months-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .month-card { background: #fff; border: 2px solid #eee; padding: 25px; border-radius: 10px; text-align: center; cursor: pointer; font-weight: bold; color: #667eea; }
        
        .days-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px; }
        .day-card { border: 2px solid #eee; padding: 15px; border-radius: 8px; text-align: center; cursor: pointer; background: white; }
        .closed-morning { color: #dc3545; font-size: 0.8em; font-weight: bold; margin-top: 5px; }

        .postes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .poste-box { height: 160px; border: 3px solid #dee2e6; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; position: relative; background: #f8f9fa; padding: 10px; text-align: center; }
        .poste-box.libre { border-color: #28a745; background: #e8f5e9; }
        .poste-box.reserve { border-color: #ffc107; background: #fff9e6; }
        .poste-box.controle { border-color: #17a2b8; background: #e7f6f8; }
        .poste-box.controleur { border-color: #ffd700; border-width: 4px; background: #fffbf0; }

        .badge-peche { color: #28a745; font-size: 0.72em; font-weight: bold; margin-top: 8px; border: 1.5px solid #28a745; padding: 3px 6px; border-radius: 5px; background: white; }

        .modal { display: none; position: fixed; z-index: 1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); }
        .modal-content { background:white; margin: 5% auto; padding:20px; border-radius:15px; width:90%; max-width:450px; }
        input[type="text"], input[type="password"] { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }
        .btn { padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body class="login-mode">

    <div id="loginPage">
        <h2>üëÆ Connexion Hardt 2026</h2>
        <input type="password" id="loginPass" placeholder="Mot de passe" autofocus>
        <button class="btn" style="background:#667eea; color:white;" onclick="checkLogin()">Entrer</button>
    </div>

    <div id="mainApp">
        <div class="header">
            <span class="admin-gear" onclick="openAdmin()">‚öôÔ∏è</span>
            <h1>R√©servations Hardt 2026</h1>
        </div>
        <div class="breadcrumb">
            <a onclick="showMonths()" style="cursor:pointer;">üè† Accueil</a>
            <a onclick="location.reload()" style="color:red; cursor:pointer;">D√©connexion</a>
        </div>
        
        <div id="monthsPage" class="content">
            <div class="months-grid" id="monthsGrid"></div>
            <button onclick="showInfractions()" style="width:100%; margin-top:20px; background:#dc3545; color:white; padding:15px; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">‚ö†Ô∏è DOSSIERS INFRACTIONS</button>
        </div>

        <div id="daysPage" class="content hidden">
            <button class="btn" style="width:auto; background:#6c757d; color:white;" onclick="showMonths()">‚Üê Retour</button>
            <h2 id="monthTitle" style="margin: 20px 0; text-align:center;"></h2>
            <div class="days-grid" id="daysGrid"></div>
        </div>

        <div id="postesPage" class="content hidden">
            <button class="btn" style="width:auto; background:#6c757d; color:white;" onclick="backToDays()">‚Üê Retour</button>
            <h3 id="postePageTitle" style="margin: 20px 0; text-align:center;"></h3>
            <div id="postesGrid" class="postes-grid"></div>
        </div>

        <div id="infraPage" class="content hidden">
            <button class="btn" style="width:auto; background:#6c757d; color:white;" onclick="showMonths()">‚Üê Retour</button>
            <h2 style="margin:20px 0; color:#dc3545;">‚ö†Ô∏è Registre des Infractions</h2>
            <div id="infraList" style="background:#f8f9fa; padding:15px; border-radius:10px;"></div>
        </div>
    </div>

    <div id="posteModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Poste</h3>
            <input type="text" id="modalNom" placeholder="NOM" oninput="checkCard()">
            <input type="text" id="modalPrenom" placeholder="Pr√©nom" oninput="checkCard()">
            <div id="cardStatus" style="margin-bottom:10px; display:none;"></div>
            <label><input type="checkbox" id="modalControle" onchange="updateTime()"> Contr√¥l√©</label>
            <input type="hidden" id="modalHeure">
            <button class="btn" style="background:#28a745; color:white;" onclick="savePoste()">üíæ Enregistrer</button>
            
            <div id="actionInfra" style="margin-top:10px; display:none; gap:5px; display:flex;">
                <button class="btn" style="background:#ffc107; margin:0;" onclick="addInfra('Avertissement')">‚ö†Ô∏è Avertir</button>
                <button class="btn" style="background:#000; color:white; margin:0;" onclick="addInfra('Banni')">üö´ Bannir</button>
            </div>

            <button class="btn" style="background:#dc3545; color:white;" onclick="deletePoste()">üóëÔ∏è Effacer</button>
            <button class="btn" style="background:#eee;" onclick="closeModal()">Fermer</button>
        </div>
    </div>

    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h3>ü™™ Liste P√™cheurs Valides</h3>
            <input type="text" id="addNom" placeholder="NOM">
            <input type="text" id="addPrenom" placeholder="Pr√©nom">
            <button class="btn" style="background:#28a745; color:white;" onclick="addPecheur()">Ajouter</button>
            <div id="listPecheurs" style="max-height:200px; overflow-y:auto; margin-top:15px; border-top:1px solid #eee;"></div>
            <button class="btn" onclick="document.getElementById('adminModal').style.display='none'">Fermer</button>
        </div>
    </div>

    <script>
        const OUVERTURE = { 2:[28], 3:[28], 4:[25], 5:[13], 7:[19], 8:[17], 9:[14] };
        const FERME_M = { 2:[28], 3:[28], 4:[25], 5:[13], 7:[19], 8:[17], 9:[14] };
        const MOIS_NOMS = ["","","F√©vrier","Mars","Avril","Mai","Juin","Juillet","Ao√ªt","Septembre","Octobre","Novembre"];

        let dataRes = JSON.parse(localStorage.getItem('hardt_res_2026')) || {};
        let pecheursValides = JSON.parse(localStorage.getItem('hardt_valides')) || [];
        let infractions = JSON.parse(localStorage.getItem('hardt_infra')) || [];
        let curM, curKey, curDF, curP;

        function checkLogin() {
            if(document.getElementById('loginPass').value === "911") {
                document.body.className = "app-mode";
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                renderMonths();
            }
        }

        function renderMonths() {
            const grid = document.getElementById('monthsGrid'); grid.innerHTML = "";
            for (let m in OUVERTURE) {
                let div = document.createElement('div'); div.className = "month-card";
                div.innerHTML = MOIS_NOMS[m]; div.onclick = () => showDays(m);
                grid.appendChild(div);
            }
        }

        function showDays(m) {
            curM = m; hideAll(); document.getElementById('daysPage').classList.remove('hidden');
            document.getElementById('monthTitle').textContent = MOIS_NOMS[m] + " 2026";
            const grid = document.getElementById('daysGrid'); grid.innerHTML = "";
            OUVERTURE[m].forEach(j => {
                let df = new Date(2026, m-1, j).toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});
                let key = `2026-${m}-${j}`;
                let div = document.createElement('div'); div.className = "day-card";
                div.innerHTML = `<strong>${df}</strong>`;
                if(FERME_M[m] && FERME_M[m].includes(j)) div.innerHTML += `<div class="closed-morning">FERM√â MATIN</div>`;
                div.onclick = () => showPostes(key, df); grid.appendChild(div);
            });
        }

        function showPostes(key, df) {
            curKey = key; curDF = df; hideAll(); document.getElementById('postesPage').classList.remove('hidden');
            document.getElementById('postePageTitle').textContent = df;
            const grid = document.getElementById('postesGrid'); grid.innerHTML = "";
            if(!dataRes[key]) dataRes[key] = {};
            for(let i=1; i<=12; i++) {
                let p = dataRes[key][i] || {nom:"", prenom:"", controlled:false};
                let hasN = p.nom && p.nom.trim() !== "";
                let isV = hasN && pecheursValides.some(x => x.nom.toLowerCase() === p.nom.toLowerCase() && x.prenom.toLowerCase() === p.prenom.toLowerCase());
                let isBanni = hasN && infractions.some(x => x.nom.toLowerCase() === p.nom.toLowerCase() && x.prenom.toLowerCase() === p.prenom.toLowerCase() && x.type === 'Banni');

                let div = document.createElement('div');
                div.className = `poste-box ${i===4?'controleur':(p.controlled?'controle':(hasN?'reserve':'libre'))}`;
                if(isBanni) div.style.background = "#000";
                div.innerHTML = `<strong>Poste ${i}</strong>`;
                if(hasN) {
                    div.innerHTML += `<div style="text-transform:uppercase; font-weight:bold; margin-top:5px; ${isBanni?'color:white;':''}">${p.nom} ${p.prenom}</div>`;
                    if(isV && !isBanni) div.innerHTML += `<div class="badge-peche">ü™™ Carte de p√™che valide</div>`;
                    if(isBanni) div.innerHTML += `<div style="color:red; font-size:0.8em; font-weight:bold;">üö´ BANNI</div>`;
                }
                div.onclick = () => openModal(i, p); grid.appendChild(div);
            }
        }

        function openModal(n, p) {
            curP = n; document.getElementById('modalNom').value = p.nom || "";
            document.getElementById('modalPrenom').value = p.prenom || "";
            document.getElementById('modalControle').checked = p.controlled || false;
            document.getElementById('actionInfra').style.display = p.nom ? 'flex' : 'none';
            checkCard(); document.getElementById('posteModal').style.display = 'block';
        }

        function checkCard() {
            const n = document.getElementById('modalNom').value.trim().toLowerCase();
            const p = document.getElementById('modalPrenom').value.trim().toLowerCase();
            const found = pecheursValides.some(x => x.nom.toLowerCase() === n && x.prenom.toLowerCase() === p);
            document.getElementById('cardStatus').style.display = (n && p && found) ? 'block' : 'none';
            document.getElementById('cardStatus').innerHTML = '<span style="color:#28a745; font-weight:bold;">ü™™ Carte de p√™che valide</span>';
        }

        function savePoste() {
            let n = document.getElementById('modalNom').value.trim(), p = document.getElementById('modalPrenom').value.trim();
            if(n) dataRes[curKey][curP] = { nom:n, prenom:p, controlled:document.getElementById('modalControle').checked, heure:document.getElementById('modalHeure').value };
            else delete dataRes[curKey][curP];
            localStorage.setItem('hardt_res_2026', JSON.stringify(dataRes));
            showPostes(curKey, curDF); closeModal();
        }

        function addInfra(type) {
            let n = document.getElementById('modalNom').value.trim(), p = document.getElementById('modalPrenom').value.trim();
            infractions.push({nom:n, prenom:p, type:type, date:curDF});
            localStorage.setItem('hardt_infra', JSON.stringify(infractions));
            alert(type + " enregistr√© pour " + n);
            showPostes(curKey, curDF); closeModal();
        }

        function showInfractions() {
            hideAll(); document.getElementById('infraPage').classList.remove('hidden');
            const list = document.getElementById('infraList'); list.innerHTML = infractions.length ? "" : "Aucun dossier.";
            infractions.forEach((x, i) => {
                list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #ddd; display:flex; justify-content:space-between;">
                    <span><strong>${x.type}</strong>: ${x.nom} ${x.prenom} (${x.date})</span>
                    <button onclick="removeInfra(${i})" style="color:red; border:none; background:none; cursor:pointer;">Supprimer</button>
                </div>`;
            });
        }

        function removeInfra(i) { infractions.splice(i,1); localStorage.setItem('hardt_infra', JSON.stringify(infractions)); showInfractions(); }
        function deletePoste() { delete dataRes[curKey][curP]; localStorage.setItem('hardt_res_2026', JSON.stringify(dataRes)); showPostes(curKey, curDF); closeModal(); }
        function updateTime() { if(document.getElementById('modalControle').checked) { let d=new Date(); document.getElementById('modalHeure').value = d.getHours()+":"+d.getMinutes().toString().padStart(2,'0'); } }
        function closeModal() { document.getElementById('posteModal').style.display='none'; }
        function hideAll() { ['monthsPage','daysPage','postesPage','infraPage'].forEach(id => document.getElementById(id).classList.add('hidden')); }
        function showMonths() { hideAll(); document.getElementById('monthsPage').classList.remove('hidden'); }
        function backToDays() { showDays(curM); }
        function openAdmin() { if(prompt("Pass Admin") === "admin") { renderAdminList(); document.getElementById('adminModal').style.display='block'; } }
        function addPecheur() {
            let n = document.getElementById('addNom').value.trim(), p = document.getElementById('addPrenom').value.trim();
            if(n && p) { pecheursValides.push({nom:n, prenom:p}); localStorage.setItem('hardt_valides', JSON.stringify(pecheursValides)); renderAdminList(); }
        }
        function renderAdminList() {
            const list = document.getElementById('listPecheurs'); list.innerHTML = "";
            pecheursValides.forEach((x, i) => { list.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>${x.nom.toUpperCase()} ${x.prenom}</span><button onclick="removeP(${i})" style="color:red; border:none; background:none; cursor:pointer;">‚úñ</button></div>`; });
        }
        function removeP(i) { pecheursValides.splice(i,1); localStorage.setItem('hardt_valides', JSON.stringify(pecheursValides)); renderAdminList(); }
    </script>
</body>
</html>
