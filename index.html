<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©servation Postes Hardt 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .breadcrumb {
            background: #f8f9fa;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95em;
            color: #6c757d;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content {
            padding: 30px;
        }

        /* Page des mois */
        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .month-card {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .month-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .month-card .month-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .month-card .month-info {
            font-size: 0.9em;
            color: #6c757d;
        }

        /* Page des jours */
        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .day-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .day-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 3px 15px rgba(102, 126, 234, 0.2);
        }

        .day-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .day-name {
            font-size: 0.9em;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .day-stats {
            font-size: 0.85em;
            color: #28a745;
            margin-top: 10px;
        }

        /* Page des postes */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .postes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }

        .poste-box {
            background: #f8f9fa;
            border: 3px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .poste-checkbox {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            z-index: 10;
        }

        .poste-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .poste-box.libre {
            border-color: #28a745;
            background: #e8f5e9;
        }

        .poste-box.libre:hover {
            border-color: #1e7e34;
        }

        .poste-box.reserve {
            border-color: #ffc107;
            background: #fff9e6;
        }

        .poste-box.reserve:hover {
            border-color: #e0a800;
        }

        .poste-box.controle {
            border-color: #17a2b8;
            background: #e7f6f8;
        }

        .poste-box.controle:hover {
            border-color: #117a8b;
        }

        .poste-box.controleur {
            border-color: #ffd700;
            border-width: 4px;
            background: linear-gradient(135deg, #fff9e6 0%, #fffbf0 100%);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
        }

        .poste-box.controleur:hover {
            border-color: #ffcc00;
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.5);
        }

        .poste-box.controleur .poste-number {
            color: #d4a500;
        }

        .poste-box.controleur .status-icon {
            filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5));
        }

        .poste-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .poste-status {
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .poste-name {
            font-size: 0.95em;
            color: #495057;
            font-weight: 600;
            margin-top: 10px;
            word-break: break-word;
        }

        .status-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        /* Modal d'alerte personnalis√© */
        .alert-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            animation: fadeIn 0.3s;
        }

        .alert-content {
            background-color: white;
            margin: 15% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            animation: slideDown 0.3s;
        }

        .alert-header {
            padding: 25px;
            border-radius: 15px 15px 0 0;
            text-align: center;
            color: white;
            font-size: 1.5em;
            font-weight: bold;
        }

        .alert-header.warning {
            background: linear-gradient(135deg, #ff8c00 0%, #ffc107 100%);
        }

        .alert-header.error {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .alert-body {
            padding: 30px;
            text-align: center;
            font-size: 1.1em;
            line-height: 1.6;
            color: #333;
        }

        .alert-footer {
            padding: 20px;
            text-align: center;
            border-top: 1px solid #ddd;
        }

        .alert-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 40px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .alert-btn:hover {
            transform: scale(1.05);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            text-align: center;
        }

        .modal-header h2 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            font-size: 16px;
            color: #495057;
            cursor: pointer;
            margin: 0;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
        }

        .btn-save {
            background: #28a745;
            color: white;
        }

        .btn-save:hover {
            background: #218838;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .btn-cancel:hover {
            background: #5a6268;
        }

        .btn-back {
            background: #6c757d;
            color: white;
            display: inline-block;
            padding: 12px 25px;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
        }

        .btn-back:hover {
            background: #5a6268;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn-action {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-export {
            background: #17a2b8;
            color: white;
        }

        .btn-export:hover {
            background: #138496;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .months-grid {
                grid-template-columns: 1fr;
            }
            
            .days-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .postes-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .stats-bar {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 20% auto;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã R√©servation Postes Hardt 2026</h1>
            <p id="headerSubtitle">S√©lectionnez un mois</p>
        </div>

        <div class="breadcrumb" id="breadcrumb">
            <a onclick="showMonths()">Accueil</a>
        </div>

        <div id="monthsPage" class="content">
            <div class="months-grid">
                <div class="month-card" onclick="showDays(1, 'F√©vrier')">
                    <div class="month-name">F√©vrier</div>
                    <div class="month-info">2026</div>
                </div>
                <div class="month-card" onclick="showDays(2, 'Mars')">
                    <div class="month-name">Mars</div>
                    <div class="month-info">2026</div>
                </div>
                <div class="month-card" onclick="showDays(3, 'Avril')">
                    <div class="month-name">Avril</div>
                    <div class="month-info">2026</div>
                </div>
                <div class="month-card" onclick="showDays(4, 'Mai')">
                    <div class="month-name">Mai</div>
                    <div class="month-info">2026</div>
                </div>
                <div class="month-card" onclick="showDays(5, 'Juin')">
                    <div class="month-name">Juin</div>
                    <div class="month-info">2026</div>
                </div>
                <div class="month-card" onclick="showDays(6, 'Juillet')">
                    <div class="month-name">Juillet</div>
                    <div class="month-info">2026</div>
                </div>
                <div class="month-card" onclick="showDays(7, 'Ao√ªt')">
                    <div class="month-name">Ao√ªt</div>
                    <div class="month-info">2026</div>
                </div>
                <div class="month-card" onclick="showDays(8, 'Septembre')">
                    <div class="month-name">Septembre</div>
                    <div class="month-info">2026</div>
                </div>
                <div class="month-card" onclick="showDays(9, 'Octobre')">
                    <div class="month-name">Octobre</div>
                    <div class="month-info">2026</div>
                </div>
                <div class="month-card" onclick="showDays(10, 'Novembre')">
                    <div class="month-name">Novembre</div>
                    <div class="month-info">2026</div>
                </div>
                <div class="month-card" onclick="showDays(11, 'D√©cembre')">
                    <div class="month-name">D√©cembre</div>
                    <div class="month-info">2026</div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn-action" onclick="showInfractions()" style="background: #e53e3e; color: white; padding: 15px 30px; font-size: 1.1em; border: none; border-radius: 8px; cursor: pointer;">
                    ‚ö†Ô∏è Listing Infractions
                </button>
            </div>
        </div>

        <div id="infractionsPage" class="content hidden">
            <button class="btn-back" onclick="showMonths()">‚Üê Retour √† l'accueil</button>
            <h2 style="text-align: center; margin: 20px 0; color: #e53e3e; font-size: 2em;">‚ö†Ô∏è Listing des Infractions</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; max-width: 1200px; margin: 0 auto;">
                <div style="background: transparent; padding: 20px; border-radius: 12px; border: 3px solid #000;">
                    <h3 style="color: #ff8c00; text-align: center; margin-bottom: 15px;">‚ö†Ô∏è AVERTISSEMENTS</h3>
                    <div id="avertissementsList" style="min-height: 200px;"></div>
                </div>
                
                <div style="background: transparent; padding: 20px; border-radius: 12px; border: 3px solid #000;">
                    <h3 style="color: #dc3545; text-align: center; margin-bottom: 15px;">üö´ BANNIS</h3>
                    <div id="bannisList" style="min-height: 200px;"></div>
                </div>
            </div>
        </div>

        <div id="daysPage" class="content hidden">
            <button class="btn-back" onclick="showMonths()">‚Üê Retour aux mois</button>
            <h2 id="monthTitle" style="text-align: center; margin: 20px 0; color: #5a67d8; font-size: 2em;"></h2>
            <div id="daysGrid" class="days-grid"></div>
        </div>

        <div id="postesPage" class="content hidden">
            <button class="btn-back" onclick="backToDays()">‚Üê Retour aux jours</button>
            
            <h2 id="fullDateTitle" style="text-align: center; margin: 10px 0 25px 0; color: #4a5568; font-size: 1.8em; font-weight: bold;"></h2>

            <div class="stats-bar">
                <div class="stat-box">
                    <div class="stat-number" id="statLibre">12</div>
                    <div class="stat-label">Postes libres</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="statReserve">0</div>
                    <div class="stat-label">Postes r√©serv√©s</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="statControle">0</div>
                    <div class="stat-label">Postes contr√¥l√©s</div>
                </div>
            </div>

            <div id="postesGrid" class="postes-grid"></div>
        </div>
    </div>

    <div id="posteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Poste 1</h2>
                <p id="modalDate"></p>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modalNom">Nom</label>
                    <input type="text" id="modalNom" placeholder="Entrez le nom">
                </div>
                <div class="form-group">
                    <label for="modalPrenom">Pr√©nom</label>
                    <input type="text" id="modalPrenom" placeholder="Entrez le pr√©nom">
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="modalControle">
                    <label for="modalControle">Marquer comme contr√¥l√©</label>
                </div>
                
                <div id="infractionsButtons" style="margin-top: 15px; display: none; border-top: 1px solid #ddd; padding-top: 15px;">
                    <p style="font-weight: bold; color: #666; margin-bottom: 10px;">‚ö†Ô∏è Infractions :</p>
                    <div style="display: flex; gap: 20px;">
                        <button class="btn" onclick="addAvertissement()" style="background: #ffc107; color: #000; flex: 1;">
                            ‚ö†Ô∏è Avertissement
                        </button>
                        <button class="btn" onclick="addBanni()" style="background: #dc3545; color: white; flex: 1;">
                            üö´ Bannir
                        </button>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button class="btn btn-save" onclick="saveModal()">üíæ Sauvegarder</button>
                    <button class="btn btn-delete" onclick="deleteModal()">üóëÔ∏è Effacer</button>
                    <button class="btn btn-cancel" onclick="closeModal()">‚ùå Annuler</button>
                </div>
            </div>
        </div>
    </div>

    <div id="alertModal" class="alert-modal">
        <div class="alert-content">
            <div id="alertHeader" class="alert-header"></div>
            <div id="alertBody" class="alert-body"></div>
            <div class="alert-footer">
                <button class="alert-btn" onclick="closeAlert()">OK</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const NUM_POSTES = 12;
        const JOURS_OUVERTURE = {
            0: [], // Janvier
            1: [28], // F√©vrier
            2: [6, 7, 13, 14, 20, 21, 22, 27, 28], // Mars
            3: [3, 4, 5, 10, 11, 17, 18, 24, 25], // Avril
            4: [5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], // Mai
            5: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30], // Juin
            6: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], // Juillet
            7: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31], // Ao√ªt
            8: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30], // Septembre
            9: [2, 3, 9, 10, 16, 17, 23, 24, 30, 31], // Octobre
            10: [6, 7, 10, 13, 14, 20, 21, 27, 28], // Novembre
            11: [4, 5, 11, 12, 18, 19, 24, 25, 26] // D√©cembre
        };

        // RESTAURATION DES JOURS FERM√âS LE MATIN
        const JOURS_FERMES_MATIN = {
            2: [28], 
            3: [25], 
            5: [13], 
            8: [19], 
            9: [17], 
            10: [14] 
        };

        const JOURS_SEMAINE = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
        
        let reservations = {};
        let infractions = { avertissements: [], bannis: [] };
        let currentMonth = 0;
        let currentMonthName = '';
        let currentDay = 0;
        let currentDateKey = '';
        let currentPosteNum = 0;

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });

        function showMonths() {
            document.getElementById('monthsPage').classList.remove('hidden');
            document.getElementById('daysPage').classList.add('hidden');
            document.getElementById('postesPage').classList.add('hidden');
            document.getElementById('infractionsPage').classList.add('hidden');
            document.getElementById('headerSubtitle').textContent = 'S√©lectionnez un mois';
            document.getElementById('breadcrumb').innerHTML = '<a onclick="showMonths()">Accueil</a>';
        }

        function showDays(monthIndex, monthName) {
            currentMonth = monthIndex;
            currentMonthName = monthName;
            document.getElementById('monthsPage').classList.add('hidden');
            document.getElementById('daysPage').classList.remove('hidden');
            document.getElementById('postesPage').classList.add('hidden');
            document.getElementById('headerSubtitle').textContent = `${monthName} 2026 - Jours d'ouverture`;
            document.getElementById('monthTitle').textContent = `${monthName} 2026`;
            document.getElementById('breadcrumb').innerHTML = `<a onclick="showMonths()">Accueil</a> > <span>${monthName}</span>`;
            renderDays(monthIndex);
        }

        function renderDays(monthIndex) {
            const grid = document.getElementById('daysGrid');
            grid.innerHTML = '';
            const jours = JOURS_OUVERTURE[monthIndex] || [];
            
            jours.forEach(jour => {
                const date = new Date(2026, monthIndex, jour);
                const jourSemaine = JOURS_SEMAINE[date.getDay()];
                const dateKey = `2026-${String(monthIndex + 1).padStart(2, '0')}-${String(jour).padStart(2, '0')}`;
                const stats = calculateDayStats(dateKey);
                
                // AFFICHAGE DU MESSAGE "FERM√â LE MATIN"
                const fermeMatin = JOURS_FERMES_MATIN[monthIndex] && JOURS_FERMES_MATIN[monthIndex].includes(jour);
                let infoExtra = fermeMatin ? '<div style="color: #0070C0; font-size: 0.75em; font-weight: 600;">‚ö†Ô∏è Ferm√© le matin</div>' : '';
                
                const card = document.createElement('div');
                card.className = 'day-card';
                card.onclick = () => showPostes(monthIndex, jour, dateKey);
                card.innerHTML = `
                    <div class="day-number">${jour}</div>
                    <div class="day-name">${jourSemaine}</div>
                    ${infoExtra}
                    <div class="day-stats">${stats.libre} libres / ${stats.reserve} r√©serv√©s</div>
                `;
                grid.appendChild(card);
            });
        }

        function calculateDayStats(dateKey) {
            let libre = NUM_POSTES - 1;
            let reserve = 0, controle = 0;
            if (reservations[dateKey]) {
                for (let i = 1; i <= NUM_POSTES; i++) {
                    if (i === 4) continue;
                    const poste = reservations[dateKey][i];
                    if (poste && poste.nom && poste.nom.trim() !== '') {
                        if (poste.controlled) controle++; else reserve++;
                        libre--;
                    }
                }
            }
            return { libre, reserve, controle };
        }

        function showPostes(monthIndex, day, dateKey) {
            currentDay = day;
            currentDateKey = dateKey;

            // TITRE DATE COMPL√àTE
            const dateObj = new Date(currentDateKey + 'T00:00:00');
            const dateOptions = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            const fullDateString = dateObj.toLocaleDateString('fr-FR', dateOptions);
            document.getElementById('fullDateTitle').textContent = fullDateString.charAt(0).toUpperCase() + fullDateString.slice(1);

            document.getElementById('daysPage').classList.add('hidden');
            document.getElementById('postesPage').classList.remove('hidden');
            document.getElementById('headerSubtitle').textContent = `${currentMonthName} ${day}, 2026 - Postes`;
            document.getElementById('breadcrumb').innerHTML = `<a onclick="showMonths()">Accueil</a> > <a onclick="showDays(${currentMonth}, '${currentMonthName}')">${currentMonthName}</a> > <span>${day}</span>`;
            renderPostes(dateKey);
        }

        function backToDays() { showDays(currentMonth, currentMonthName); }

        function renderPostes(dateKey) {
            const grid = document.getElementById('postesGrid');
            grid.innerHTML = '';
            if (!reservations[dateKey]) reservations[dateKey] = {};
            if (!reservations[dateKey][4] || !reservations[dateKey][4].nom) {
                reservations[dateKey][4] = { nom: 'Contr√¥leur', prenom: '', controlled: false };
                saveData();
            }
            let libre = 0, reserve = 0, controle = 0;
            for (let i = 1; i <= NUM_POSTES; i++) {
                const poste = reservations[dateKey][i] || { nom: '', prenom: '', controlled: false };
                if (i !== 4) {
                    if (poste.controlled) controle++; else if (poste.nom) reserve++; else libre++;
                }
                grid.appendChild(createPosteBox(i, poste, dateKey));
            }
            updateStats(libre, reserve, controle);
        }

        function createPosteBox(posteNum, data, dateKey) {
            const div = document.createElement('div');
            const hasName = data.nom && data.nom.trim() !== '';
            const isControlled = data.controlled;
            const isControleur = (posteNum === 4);
            let boxClass = 'poste-box ' + (isControleur ? 'controleur' : isControlled ? 'controle' : hasName ? 'reserve' : 'libre');
            let statusIcon = isControleur ? 'üëÆ' : isControlled ? '‚úÖ' : hasName ? 'üü°' : 'üü¢';
            let statusText = isControleur ? 'Contr√¥leur' : isControlled ? 'Contr√¥l√©' : hasName ? 'R√©serv√©' : 'Libre';

            div.className = boxClass;
            div.onclick = (e) => { if (e.target.type !== 'checkbox') openModal(posteNum, data); };
            const checkboxHTML = !isControleur ? `<input type="checkbox" class="poste-checkbox" ${isControlled ? 'checked' : ''} onclick="event.stopPropagation(); toggleControle(${posteNum})">` : '';
            div.innerHTML = `${checkboxHTML}<div class="status-icon">${statusIcon}</div><div class="poste-number">Poste ${posteNum}</div><div class="poste-status">${statusText}</div>${hasName ? `<div class="poste-name">${data.nom} ${data.prenom}</div>` : ''}`;
            return div;
        }

        function openModal(posteNum, data) {
            currentPosteNum = posteNum;
            const isControleur = (posteNum === 4);
            document.getElementById('modalTitle').textContent = isControleur ? `Poste ${posteNum} - Contr√¥leur` : `Poste ${posteNum}`;
            document.getElementById('modalNom').value = data.nom || '';
            document.getElementById('modalPrenom').value = data.prenom || '';
            document.getElementById('modalControle').checked = data.controlled || false;
            document.querySelector('.checkbox-group').style.display = isControleur ? 'none' : 'flex';
            document.getElementById('infractionsButtons').style.display = (data.nom && data.prenom) ? 'block' : 'none';
            document.getElementById('posteModal').style.display = 'block';
        }

        function closeModal() { document.getElementById('posteModal').style.display = 'none'; }

        function saveModal() {
            const nom = document.getElementById('modalNom').value.trim();
            const prenom = document.getElementById('modalPrenom').value.trim();
            if (nom && prenom) {
                const nomComplet = `${nom} ${prenom}`.toLowerCase();
                if (infractions.bannis.some(b => `${b.nom} ${b.prenom}`.toLowerCase() === nomComplet)) {
                    showAlert(`<strong>${nom} ${prenom}</strong> est <strong>BANNI</strong> !`, 'error');
                    return;
                }
                const nbAvert = infractions.avertissements.filter(a => `${a.nom} ${a.prenom}`.toLowerCase() === nomComplet).length;
                if (nbAvert > 0) showAlert(`<strong>${nom} ${prenom}</strong> a <strong>${nbAvert} avertissement(s)</strong> !`, 'warning');
            }
            if (!reservations[currentDateKey]) reservations[currentDateKey] = {};
            reservations[currentDateKey][currentPosteNum] = { nom, prenom, controlled: (currentPosteNum === 4) ? false : document.getElementById('modalControle').checked };
            saveData(); renderPostes(currentDateKey); closeModal();
        }

        function deleteModal() { if (reservations[currentDateKey]) delete reservations[currentDateKey][currentPosteNum]; saveData(); renderPostes(currentDateKey); closeModal(); }
        function updateStats(l, r, c) { document.getElementById('statLibre').textContent = l; document.getElementById('statReserve').textContent = r; document.getElementById('statControle').textContent = c; }
        function toggleControle(n) { if (!reservations[currentDateKey]) reservations[currentDateKey] = {}; if (!reservations[currentDateKey][n]) reservations[currentDateKey][n] = {nom:'', prenom:'', controlled:false}; reservations[currentDateKey][n].controlled = !reservations[currentDateKey][n].controlled; saveData(); renderPostes(currentDateKey); }
        function saveData() { localStorage.setItem('reservations_hardt_2026', JSON.stringify(reservations)); localStorage.setItem('infractions_hardt_2026', JSON.stringify(infractions)); }
        function loadData() { const sR = localStorage.getItem('reservations_hardt_2026'); if (sR) reservations = JSON.parse(sR); const sI = localStorage.getItem('infractions_hardt_2026'); if (sI) infractions = JSON.parse(sI); }
        function showAlert(m, t) { const mod = document.getElementById('alertModal'); document.getElementById('alertHeader').className = 'alert-header ' + (t==='error'?'error':'warning'); document.getElementById('alertHeader').innerHTML = t==='error'?'üö´ ACTION BLOQU√âE':'‚ö†Ô∏è ATTENTION'; document.getElementById('alertBody').innerHTML = m; mod.style.display = 'block'; }
        function closeAlert() { document.getElementById('alertModal').style.display = 'none'; }

        function showInfractions() {
            document.getElementById('monthsPage').classList.add('hidden');
            document.getElementById('infractionsPage').classList.remove('hidden');
            renderInfractionsList();
        }

        function renderInfractionsList() {
            const listA = document.getElementById('avertissementsList');
            const listB = document.getElementById('bannisList');
            listA.innerHTML = infractions.avertissements.length ? infractions.avertissements.map(p => `<div style="padding:10px; margin-bottom:10px; background:white; border-radius:8px; border-left:4px solid #ffc107;"><strong>${p.nom} ${p.prenom}</strong><br><small>Le ${p.date}</small><br><button onclick="removeAvertissement('${p.id}')" style="background:#dc3545; color:white; border:none; padding:3px 8px; border-radius:4px; cursor:pointer; font-size:0.8em;">Retirer</button></div>`).join('') : '<p style="text-align:center;color:#999">Aucun</p>';
            listB.innerHTML = infractions.bannis.length ? infractions.bannis.map(p => `<div style="padding:10px; margin-bottom:10px; background:white; border-radius:8px; border-left:4px solid #dc3545;"><strong>${p.nom} ${p.prenom}</strong><br><small>Le ${p.date}</small><br><button onclick="removeBanni('${p.id}')" style="background:#28a745; color:white; border:none; padding:3px 8px; border-radius:4px; cursor:pointer; font-size:0.8em;">D√©bannir</button></div>`).join('') : '<p style="text-align:center;color:#999">Aucun</p>';
        }

        // GESTION AUTOMATIQUE : 3√®me AVERTISSEMENT -> BANNI
        function addAvertissement() {
            const nom = document.getElementById('modalNom').value.trim();
            const prenom = document.getElementById('modalPrenom').value.trim();
            if (!nom || !prenom) return;
            const nomComplet = `${nom} ${prenom}`.toLowerCase();
            const nbActuel = infractions.avertissements.filter(a => `${a.nom} ${a.prenom}`.toLowerCase() === nomComplet).length;

            if (nbActuel >= 2) {
                // Il en a d√©j√† 2, celui-ci est le 3√®me -> Ban
                infractions.avertissements = infractions.avertissements.filter(a => `${a.nom} ${a.prenom}`.toLowerCase() !== nomComplet);
                infractions.bannis.push({ id: Date.now().toString(), nom, prenom, date: new Date().toLocaleDateString('fr-FR') });
                showAlert(`<strong>${nom} ${prenom}</strong> a re√ßu son <strong>3√®me avertissement</strong>.<br>Il est d√©sormais <strong>BANNI</strong>.`, 'error');
            } else {
                infractions.avertissements.push({ id: Date.now().toString(), nom, prenom, date: new Date().toLocaleDateString('fr-FR') });
                showAlert(`Avertissement ajout√© pour <strong>${nom} ${prenom}</strong>.<br>Total : <strong>${nbActuel + 1}</strong>`, 'warning');
            }
            saveData(); closeModal();
        }

        function addBanni() {
            const nom = document.getElementById('modalNom').value.trim();
            const prenom = document.getElementById('modalPrenom').value.trim();
            if (!nom || !prenom) return;
            infractions.bannis.push({ id: Date.now().toString(), nom, prenom, date: new Date().toLocaleDateString('fr-FR') });
            saveData(); showAlert(`<strong>${nom} ${prenom}</strong> banni.`, 'error'); closeModal();
        }

        function removeAvertissement(id) { infractions.avertissements = infractions.avertissements.filter(a => a.id !== id); saveData(); renderInfractionsList(); }
        function removeBanni(id) { infractions.bannis = infractions.bannis.filter(b => b.id !== id); saveData(); renderInfractionsList(); }

        window.onclick = function(e) { if (e.target == document.getElementById('posteModal')) closeModal(); }
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
    </script>
</body>
</html>
